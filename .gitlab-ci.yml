stages:
  - build:commons
  - build
  - test
  - run

# Maven

.maven:
  image: maven:latest
  variables:
    MAVEN_CLI_OPTS: "--batch-mode"
    MAVEN_OPTS: "-Dmaven.repo.local=.m2/repository -Dstyle.color=always -Djansi.force=true"

.maven:compile:
  stage: build
  needs:
    - job: commons:kotlin:deploy
      optional: true
  dependencies:
    - commons:kotlin:deploy
  script:
    - mvn $MAVEN_CLI_OPTS clean compile package -Dmaven.test.skip=true

.maven:test:
  stage: test
  script:
    - mvn $MAVEN_CLI_OPTS test

# Gradle

.gradle:
  image: openjdk:17.0.2-jdk-slim

.gradle:compile:
  extends: .gradle
  stage: build
  needs:
    - job: commons:kotlin:deploy
      optional: true
  dependencies:
    - commons:kotlin:deploy
  script:
    - ./gradlew clean build -x check

.gradle:test:
  stage: test
  script:
    - ./gradlew check

# Projects

include:
  - local: /aoc-commons/.gitlab-ci.yml
  - local: /2022/kotlin/.gitlab-ci.yml
  - local: /2021/kotlin/.gitlab-ci.yml
  - local: /2020/kotlin/.gitlab-ci.yml
  - local: /2020/lua/.gitlab-ci.yml
  - local: /2015/.gitlab-ci.yml
